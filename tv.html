<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="refresh" content="300">
<title>RockRunner â€” Yard Display</title>
<style>
:root {
  --navy: #001F3F;
  --navy-light: #0a2d52;
  --navy-dark: #001530;
  --orange: #C65D2A;
  --orange-dim: rgba(198,93,42,0.15);
  --green: #22c55e;
  --green-dim: rgba(34,197,94,0.12);
  --yellow: #eab308;
  --yellow-dim: rgba(234,179,8,0.12);
  --blue: #3b82f6;
  --blue-dim: rgba(59,130,246,0.12);
  --red: #ef4444;
  --purple: #a855f7;
  --purple-dim: rgba(168,85,247,0.12);
  --surface: #0f1923;
  --surface2: #162230;
  --border: #1e3347;
  --text: #e4e8ef;
  --text-dim: #7a8da0;
  --text-muted: #4a5d73;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: var(--navy-dark);
  color: var(--text);
  overflow: hidden;
  height: 100vh;
}

/* â”€â”€â”€ HEADER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tv-header {
  background: var(--navy);
  border-bottom: 2px solid var(--border);
  padding: 14px 28px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.tv-header-left {
  display: flex;
  align-items: center;
  gap: 16px;
}
.tv-logo { height: 40px; border-radius: 6px; }
.tv-title {
  font-size: 22px;
  font-weight: 700;
  color: var(--orange);
  letter-spacing: -0.3px;
}
.tv-subtitle {
  font-size: 13px;
  color: var(--text-dim);
}
.tv-header-right {
  display: flex;
  align-items: center;
  gap: 24px;
}
.tv-date {
  font-size: 18px;
  font-weight: 600;
  text-align: right;
}
.tv-time {
  font-size: 14px;
  color: var(--text-dim);
}
.tv-refresh-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--green);
  animation: blink 3s infinite;
}
@keyframes blink { 0%,90%{opacity:1} 95%{opacity:0.3} 100%{opacity:1} }

/* â”€â”€â”€ STATS STRIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-strip {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 12px 28px;
  display: flex;
  gap: 32px;
  align-items: center;
}
.stat-block {
  display: flex;
  align-items: center;
  gap: 10px;
}
.stat-icon {
  width: 38px;
  height: 38px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}
.stat-value {
  font-size: 24px;
  font-weight: 700;
}
.stat-label {
  font-size: 11px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.8px;
}

.legend {
  margin-left: auto;
  display: flex;
  gap: 18px;
  align-items: center;
}
.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--text-dim);
}
.legend-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

/* â”€â”€â”€ MAIN LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tv-main {
  display: grid;
  grid-template-columns: 1fr 380px;
  height: calc(100vh - 128px);
}

/* â”€â”€â”€ LEFT: TODAY'S BOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.today-panel {
  padding: 20px 24px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}
.panel-title {
  font-size: 14px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-dim);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.panel-title .count {
  background: var(--orange);
  color: #fff;
  font-size: 11px;
  padding: 2px 8px;
  border-radius: 8px;
  font-weight: 700;
}

/* Truck rows */
.truck-rows {
  flex: 1;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding-right: 8px;
}
.truck-rows::-webkit-scrollbar { width: 4px; }
.truck-rows::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

.truck-row {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
}
.truck-row-header {
  padding: 12px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
  background: var(--surface2);
}
.truck-row-name {
  font-size: 15px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
}
.truck-row-meta {
  font-size: 12px;
  color: var(--text-dim);
}
.truck-row-load {
  font-size: 13px;
  font-weight: 600;
}
.load-ok { color: var(--green); }
.load-warn { color: var(--yellow); }
.load-over { color: var(--red); }

.truck-stops {
  padding: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

/* Delivery tile */
.del-tile {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 12px;
  min-width: 220px;
  flex: 1;
  position: relative;
  border-left: 3px solid var(--border);
  transition: border-color 0.3s;
}
.del-tile.status-SCHEDULED { border-left-color: var(--blue); }
.del-tile.status-EN_ROUTE { border-left-color: var(--purple); animation: route-glow 2s infinite; }
.del-tile.status-DELIVERED { border-left-color: var(--green); opacity: 0.65; }

@keyframes route-glow {
  0%,100% { box-shadow: 0 0 0 0 rgba(168,85,247,0); }
  50% { box-shadow: 0 0 12px 2px rgba(168,85,247,0.15); }
}

.del-tile-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 4px;
}
.del-tile-customer {
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
}
.del-tile-status {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 2px 7px;
  border-radius: 4px;
}
.status-badge-SCHEDULED { background: var(--blue-dim); color: var(--blue); }
.status-badge-EN_ROUTE { background: var(--purple-dim); color: var(--purple); }
.status-badge-DELIVERED { background: var(--green-dim); color: var(--green); }

.del-tile-material { font-size: 12px; color: var(--text-dim); }
.del-tile-address { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
.del-tile-time { font-size: 11px; color: var(--orange); margin-top: 4px; font-weight: 600; }
.del-tile-tons {
  position: absolute;
  top: 10px;
  right: 12px;
  font-size: 13px;
  font-weight: 700;
  color: var(--orange);
}
.source-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
  display: inline-block;
}
.src-tgr { background: var(--green); }
.src-yard { background: var(--yellow); }
.src-tc { background: var(--blue); }

.no-stops {
  padding: 20px;
  text-align: center;
  color: var(--text-muted);
  font-size: 13px;
}

/* â”€â”€â”€ RIGHT: INCOMING QUEUE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.queue-panel {
  background: var(--surface);
  border-left: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
.queue-panel .panel-title {
  padding: 16px 20px 0;
}
.queue-scroll {
  flex: 1;
  overflow-y: auto;
  padding: 12px 16px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.queue-scroll::-webkit-scrollbar { width: 4px; }
.queue-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* Incoming order card */
.incoming-card {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 12px 14px;
  border-left: 3px solid var(--orange);
}
.incoming-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
}
.incoming-customer {
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 6px;
}
.incoming-date {
  font-size: 11px;
  color: var(--orange);
  font-weight: 600;
}
.incoming-material {
  font-size: 12px;
  color: var(--text-dim);
}
.incoming-address {
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.incoming-tons {
  font-size: 13px;
  font-weight: 700;
  color: var(--orange);
  float: right;
  margin-top: -32px;
}

.queue-empty {
  text-align: center;
  padding: 40px 16px;
  color: var(--text-muted);
  font-size: 13px;
}

/* â”€â”€â”€ UPCOMING DATES SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.upcoming-divider {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
  padding: 12px 0 6px;
  border-top: 1px solid var(--border);
  margin-top: 8px;
}

/* â”€â”€â”€ ALL DONE BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.all-done {
  text-align: center;
  padding: 60px 20px;
  color: var(--green);
}
.all-done-icon { font-size: 48px; margin-bottom: 12px; }
.all-done-text { font-size: 18px; font-weight: 600; }
</style>
</head>
<body>

<!-- â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tv-header">
  <div class="tv-header-left">
    <img src="logo.jpg" alt="RockRunner" class="tv-logo">
    <div>
      <div class="tv-title">RockRunner Logistics</div>
      <div class="tv-subtitle">Dispatch Board â€” Live</div>
    </div>
  </div>
  <div class="tv-header-right">
    <div>
      <div class="tv-date" id="tvDate"></div>
      <div class="tv-time" id="tvTime"></div>
    </div>
    <div class="tv-refresh-dot" title="Live â€” refreshes every 30s"></div>
  </div>
</div>

<!-- â•â•â• STATS STRIP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="stats-strip">
  <div class="stat-block">
    <div class="stat-icon" style="background:var(--orange-dim);color:var(--orange);">ğŸ“‹</div>
    <div>
      <div class="stat-value" id="tvStatTotal">0</div>
      <div class="stat-label">Today</div>
    </div>
  </div>
  <div class="stat-block">
    <div class="stat-icon" style="background:var(--blue-dim);color:var(--blue);">ğŸš›</div>
    <div>
      <div class="stat-value" id="tvStatScheduled">0</div>
      <div class="stat-label">Scheduled</div>
    </div>
  </div>
  <div class="stat-block">
    <div class="stat-icon" style="background:var(--purple-dim);color:var(--purple);">ğŸ”„</div>
    <div>
      <div class="stat-value" id="tvStatEnRoute">0</div>
      <div class="stat-label">En Route</div>
    </div>
  </div>
  <div class="stat-block">
    <div class="stat-icon" style="background:var(--green-dim);color:var(--green);">âœ…</div>
    <div>
      <div class="stat-value" id="tvStatDelivered">0</div>
      <div class="stat-label">Delivered</div>
    </div>
  </div>
  <div class="stat-block">
    <div class="stat-icon" style="background:var(--orange-dim);color:var(--orange);">âš–ï¸</div>
    <div>
      <div class="stat-value" id="tvStatTons">0</div>
      <div class="stat-label">Tons</div>
    </div>
  </div>

  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--green)"></div>TGR</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--yellow)"></div>Yard Sale</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--blue)"></div>T&C</div>
  </div>
</div>

<!-- â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tv-main">

  <!-- LEFT: Today's Deliveries by Truck -->
  <div class="today-panel">
    <div class="panel-title">Today's Deliveries <span class="count" id="todayCount">0</span></div>
    <div class="truck-rows" id="truckRows">
      <!-- Rendered by JS -->
    </div>
  </div>

  <!-- RIGHT: Incoming / Unassigned Queue -->
  <div class="queue-panel">
    <div class="panel-title">On the Books <span class="count" id="queueCount">0</span></div>
    <div class="queue-scroll" id="queueScroll">
      <!-- Rendered by JS -->
    </div>
  </div>

</div>

<script>
const API = '/.netlify/functions';
let trucks = [];
let todayDeliveries = [];
let unassignedDeliveries = [];

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  updateClock();
  setInterval(updateClock, 1000);
  loadAll();
  setInterval(loadAll, 30000); // Refresh every 30 seconds
});

function updateClock() {
  const now = new Date();
  const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  document.getElementById('tvDate').textContent = `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;

  let h = now.getHours(), m = now.getMinutes(), s = now.getSeconds();
  const ampm = h >= 12 ? 'PM' : 'AM';
  h = h % 12 || 12;
  document.getElementById('tvTime').textContent = `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')} ${ampm}`;
}

async function loadAll() {
  await loadTrucks();
  await loadTodayDeliveries();
  await loadUnassigned();
  renderToday();
  renderQueue();
  renderStats();
}

function todayISO() {
  const d = new Date();
  return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
}

// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadTrucks() {
  try {
    const r = await fetch(`${API}/trucks`);
    const d = await r.json();
    trucks = d.success ? (d.trucks || []) : [];
  } catch(e) { console.error(e); }
}

async function loadTodayDeliveries() {
  try {
    const r = await fetch(`${API}/dispatch?date=${todayISO()}`);
    const d = await r.json();
    todayDeliveries = (d.deliveries || []).filter(del => del.status !== 'CANCELLED');
  } catch(e) { todayDeliveries = []; console.error(e); }
}

async function loadUnassigned() {
  try {
    const r = await fetch(`${API}/dispatch?status=UNASSIGNED`);
    const d = await r.json();
    unassignedDeliveries = (d.deliveries || []).sort((a,b) => {
      if (a.deliveryDate < b.deliveryDate) return -1;
      if (a.deliveryDate > b.deliveryDate) return 1;
      return 0;
    });
  } catch(e) { unassignedDeliveries = []; console.error(e); }
}

// â”€â”€â”€ RENDER TODAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderToday() {
  const container = document.getElementById('truckRows');
  const assigned = todayDeliveries.filter(d => d.truckId);
  document.getElementById('todayCount').textContent = todayDeliveries.length;

  if (!trucks.length) {
    container.innerHTML = '<div class="no-stops">No trucks in roster</div>';
    return;
  }

  // Check if all deliveries are done
  const allDone = assigned.length > 0 && assigned.every(d => d.status === 'DELIVERED');

  container.innerHTML = trucks.map(truck => {
    const truckDels = assigned
      .filter(d => d.truckId === truck._id)
      .sort((a,b) => (a.stopOrder || 99) - (b.stopOrder || 99));

    const totalTons = truckDels.reduce((s, d) => s + (d.quantity || 0), 0);
    const loadClass = totalTons > truck.capacity ? 'load-over' : totalTons > truck.capacity * 0.8 ? 'load-warn' : 'load-ok';
    const driverName = truck.defaultDriver ? truck.defaultDriver.name : 'No driver';

    const stopsHTML = truckDels.length
      ? truckDels.map(d => renderTile(d)).join('')
      : '<div class="no-stops">No deliveries assigned</div>';

    return `<div class="truck-row">
      <div class="truck-row-header">
        <div class="truck-row-name">ğŸš› ${truck.truckNumber} <span class="truck-row-meta">${truck.type} Â· ${driverName}</span></div>
        <div class="truck-row-load ${loadClass}">${totalTons}/${truck.capacity}T</div>
      </div>
      <div class="truck-stops">${stopsHTML}</div>
    </div>`;
  }).join('');

  // Append "all done" banner if applicable
  if (allDone && assigned.length > 0) {
    container.innerHTML += `<div class="all-done">
      <div class="all-done-icon">ğŸ‰</div>
      <div class="all-done-text">All Deliveries Complete!</div>
    </div>`;
  }
}

function renderTile(d) {
  const srcClass = d.source === 'Texas Got Rocks' ? 'src-tgr' : d.source === 'Yard Sale' ? 'src-yard' : 'src-tc';
  return `<div class="del-tile status-${d.status}">
    <div class="del-tile-header">
      <div class="del-tile-customer"><span class="source-dot ${srcClass}"></span>${d.customerName || 'Customer'}</div>
      <span class="del-tile-status status-badge-${d.status}">${formatStatus(d.status)}</span>
    </div>
    <div class="del-tile-material">${d.materialName || 'Material'} â€” ${d.quantity || '?'} tons</div>
    <div class="del-tile-address">${d.deliveryCity || d.deliveryAddress || ''}</div>
    ${d.timeWindow ? `<div class="del-tile-time">${d.timeWindow}</div>` : ''}
  </div>`;
}

function formatStatus(s) {
  const map = { SCHEDULED: 'Scheduled', EN_ROUTE: 'En Route', DELIVERED: 'Delivered' };
  return map[s] || s;
}

// â”€â”€â”€ RENDER QUEUE (ON THE BOOKS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderQueue() {
  const container = document.getElementById('queueScroll');
  const today = todayISO();

  // Split unassigned into: today, tomorrow, and future
  const todayQueue = unassignedDeliveries.filter(d => d.deliveryDate === today);
  
  // Also include ALL unassigned from any date + scheduled future deliveries
  const futureUnassigned = unassignedDeliveries.filter(d => d.deliveryDate > today);

  const total = unassignedDeliveries.length;
  document.getElementById('queueCount').textContent = total;

  if (!total) {
    container.innerHTML = '<div class="queue-empty">No unassigned orders<br>All caught up âœ“</div>';
    return;
  }

  let html = '';

  // Today's unassigned
  if (todayQueue.length) {
    html += `<div class="upcoming-divider" style="border-top:none;margin-top:0;padding-top:0;">âš ï¸ Today â€” Needs Truck</div>`;
    html += todayQueue.map(d => renderIncomingCard(d)).join('');
  }

  // Group future by date
  const futureDates = {};
  futureUnassigned.forEach(d => {
    const key = d.deliveryDate || 'No Date';
    if (!futureDates[key]) futureDates[key] = [];
    futureDates[key].push(d);
  });

  Object.keys(futureDates).sort().forEach(date => {
    html += `<div class="upcoming-divider">${formatDateLabel(date)}</div>`;
    html += futureDates[date].map(d => renderIncomingCard(d)).join('');
  });

  container.innerHTML = html;
}

function renderIncomingCard(d) {
  const srcClass = d.source === 'Texas Got Rocks' ? 'src-tgr' : d.source === 'Yard Sale' ? 'src-yard' : 'src-tc';
  return `<div class="incoming-card">
    <div class="incoming-header">
      <div class="incoming-customer"><span class="source-dot ${srcClass}"></span>${d.customerName || 'Customer'}</div>
      <div class="incoming-date">${d.deliveryDate ? formatDateShort(d.deliveryDate) : 'No date'}</div>
    </div>
    <div class="incoming-material">${d.materialName || 'Material'} â€” ${d.quantity || '?'} tons</div>
    <div class="incoming-address">${d.deliveryCity || d.deliveryAddress || 'No address'}</div>
    <div class="incoming-tons">${d.quantity || '?'}T</div>
  </div>`;
}

function formatDateLabel(dateStr) {
  if (!dateStr || dateStr === 'No Date') return 'No Date Set';
  const d = new Date(dateStr + 'T12:00:00');
  const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const today = new Date();
  const tomorrow = new Date(today);
  tomorrow.setDate(tomorrow.getDate() + 1);

  if (dateStr === todayISO()) return 'âš ï¸ Today';
  if (dateStr === formatISO(tomorrow)) return 'Tomorrow';
  return `${days[d.getDay()]}, ${months[d.getMonth()]} ${d.getDate()}`;
}

function formatDateShort(dateStr) {
  if (!dateStr) return '';
  const d = new Date(dateStr + 'T12:00:00');
  return `${d.getMonth()+1}/${d.getDate()}`;
}

function formatISO(d) {
  return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
}

// â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStats() {
  const assigned = todayDeliveries.filter(d => d.truckId);
  document.getElementById('tvStatTotal').textContent = todayDeliveries.length;
  document.getElementById('tvStatScheduled').textContent = todayDeliveries.filter(d => d.status === 'SCHEDULED').length;
  document.getElementById('tvStatEnRoute').textContent = todayDeliveries.filter(d => d.status === 'EN_ROUTE').length;
  document.getElementById('tvStatDelivered').textContent = todayDeliveries.filter(d => d.status === 'DELIVERED').length;
  document.getElementById('tvStatTons').textContent = todayDeliveries.reduce((s,d) => s + (d.quantity || 0), 0).toFixed(1);
}
</script>
</body>
</html>
